## Документация API

### Введение
Данный API предоставляет функционал для регистрации пользователей, аутентификации с помощью JWT, сканирования уязвимостей, а также получения данных о уязвимостях с внешнего ресурса.

### Зависимости для проекта

Для проекта, использующего функционал регистрации, аутентификации, сканирования уязвимостей и взаимодействия с Telegram, приведем список основных зависимостей:

---

#### **1. [axios](https://www.npmjs.com/package/axios)**
**Версия**: последняя стабильная  
**Описание**: Библиотека для выполнения HTTP-запросов. Используется для взаимодействия с внешними API.

**Установка:**
```bash
npm install axios
```

---

#### **2. [bcrypt](https://www.npmjs.com/package/bcrypt)**
**Версия**: последняя стабильная  
**Описание**: Библиотека для хеширования паролей. Используется для безопасного хранения паролей пользователей.

**Установка:**
```bash
npm install bcrypt
```

---

#### **3. [express](https://www.npmjs.com/package/express)**
**Версия**: последняя стабильная  
**Описание**: Фреймворк для создания веб-приложений и API.

**Установка:**
```bash
npm install express
```

---

#### **4. [jsonwebtoken](https://www.npmjs.com/package/jsonwebtoken)**
**Версия**: последняя стабильная  
**Описание**: Утилита для создания и проверки JSON Web Token (JWT). Используется для аутентификации и авторизации.

**Установка:**
```bash
npm install jsonwebtoken
```

---

#### **5. [mysql2](https://www.npmjs.com/package/mysql2)**
**Версия**: последняя стабильная  
**Описание**: Быстрая и удобная библиотека для работы с MySQL.

**Установка:**
```bash
npm install mysql2
```

---

#### **6. [node-html-parser](https://www.npmjs.com/package/node-html-parser)**
**Версия**: последняя стабильная  
**Описание**: Библиотека для парсинга HTML. Используется для извлечения данных из HTML-документов.

**Установка:**
```bash
npm install node-html-parser
```

---

#### **7. [node-telegram-bot-api](https://www.npmjs.com/package/node-telegram-bot-api)**
**Версия**: последняя стабильная  
**Описание**: API для создания Telegram-ботов. Используется для взаимодействия с Telegram.

**Установка:**
```bash
npm install node-telegram-bot-api
```

---

#### **8. [puppeteer](https://www.npmjs.com/package/puppeteer)**
**Версия**: последняя стабильная  
**Описание**: Библиотека для управления браузером Google Chrome. Используется для автоматизации задач, таких как парсинг или тестирование.

**Установка:**
```bash
npm install puppeteer
```

---

### Установка всех зависимостей одной командой:

Чтобы установить все зависимости сразу, выполните:

```bash
npm install axios bcrypt express jsonwebtoken mysql2 node-html-parser node-telegram-bot-api puppeteer
```

### Дополнительные рекомендации:
- После установки проверьте наличие файла `package.json` с корректно прописанными зависимостями.

---

### URL сервера
API доступен по следующему адресу:  
`http://localhost:8080/`

---

### 1. Регистрация пользователя

**POST** `/api/v1/register`

#### Параметры запроса:
- `username` (string) — имя пользователя.
- `password` (string) — пароль пользователя.

#### Ответ:
- **200 OK** — пользователь успешно зарегистрирован.
    - `token` — токен доступа на 24 часа.
    - Пример:
      ```json
      {
        "status": "OK",
        "message": "Вы успешно зарагестрировались, ваш токен: <token>",
        "token": "<token>"
      }
      ```

- **400 Bad Request** — тело запроса отсутствует.
    - Пример:
      ```json
      {
        "error": "Отсутствует тело запроса"
      }
      ```

- **409 Conflict** — пользователь с таким именем уже существует.
    - Пример:
      ```json
      {
        "status": "error",
        "message": "Пользователь с таким ником уже существует. Придумайте другой."
      }
      ```

---

### 2. Вход пользователя

**POST** `/api/v1/login`

#### Параметры запроса:
- `username` (string) — имя пользователя.
- `password` (string) — пароль пользователя.

#### Ответ:
- **200 OK** — вход выполнен успешно.
    - `token` — токен доступа на 24 часа.
    - Пример:
      ```json
      {
        "status": "OK",
        "message": "Ваш токен: <token>",
        "token": "<token>"
      }
      ```

- **400 Bad Request** — тело запроса отсутствует.
    - Пример:
      ```json
      {
        "error": "Отсутствует тело запроса"
      }
      ```

- **401 Unauthorized** — неверный логин или пароль.
    - Пример:
      ```json
      {
        "status": "error",
        "message": "Неверный логин или пароль"
      }
      ```

---

### 3. Получение списка уязвимостей

**GET** `/api/v1/vulnerabilities`

#### Ответ:
- **200 OK** — успешный запрос.
    - Пример:
      ```json
      [
        {
          "id": "CVE-2021-12345",
          "title": "Уязвимость X",
          "date": "2021-12-01",
          "info": "Описание уязвимости",
          "source": "https://example.com/exploit"
        }
      ]
      ```

- **401 Unauthorized** — токен не найден или неверен.
    - Пример:
      ```json
      {
        "status": "error",
        "message": "Токен не найден"
      }
      ```

---

### 4. Запуск сканирования уязвимостей

**POST** `/api/v1/scan`

#### Ответ:
- **200 OK** — сканирование завершено успешно.
    - Пример:
      ```json
      {
        "status": "OK",
        "message": "Скан успешно завершён! Можете гетать!"
      }
      ```

- **500 Internal Server Error** — ошибка на сервере.
    - Пример:
      ```json
      {
        "status": "error",
        "message": "Случилась непредвиденная ошибка!"
      }
      ```

---

### 5. Получение уязвимостей по IP-адресу

**POST** `/api/v1/scanIp`

#### Параметры запроса:
- `ip` (string) — IP-адрес для проверки.

#### Ответ:
- **200 OK** — уязвимости успешно найдены.
    - Пример:
      ```json
      {
        "status": "OK",
        "message": "Успешно!",
        "data": [
          {
            "name": "CVE-2021-12345",
            "cvss": 7.8,
            "ports": ["80", "443"],
            "summary": "Описание уязвимости",
            "exploit": {
              "name": "Exploit Name",
              "source": "https://sploitus.com/exploit?id=CVE-2021-12345"
            },
            "poc": "PoC для эксплуатации уязвимости"
          }
        ]
      }
      ```

- **400 Bad Request** — IP не указан.
    - Пример:
      ```json
      {
        "status": "error",
        "message": "Нет IP для проверки"
      }
      ```

- **500 Internal Server Error** — ошибка на сервере.
    - Пример:
      ```json
      {
        "status": "error",
        "message": "Ошибка сервера",
        "details": "Ошибка сервера"
      }
      ```

---

### 6. Основные ошибки

- **400 Bad Request** — запрос некорректен (например, отсутствуют обязательные параметры).
- **401 Unauthorized** — запрос требует аутентификации, но токен не предоставлен или он неверен.
- **403 Forbidden** — токен истек или пользователь не имеет прав доступа.
- **500 Internal Server Error** — внутренняя ошибка сервера.

---

### Пример запроса на получение уязвимостей
```bash
curl -X GET http://localhost:8080/api/v1/vulnerabilities \
-H "Authorization: Bearer <your_token>"
```

### Пример запроса на запуск сканирования
```bash
curl -X POST http://localhost:8080/api/v1/scan \
-H "Authorization: Bearer <your_token>"
```

---

### Руководство пользователя для настройки и запуска бота

Это руководство поможет вам настроить и запустить бота, предназначенного для поиска последних уязвимостей и проверки IP-адресов или доменных имен на уязвимости.

---

#### 1. **Установка зависимостей**

Перед запуском убедитесь, что у вас установлены:

- **Node.js** (рекомендуется версия LTS).
- **npm** — менеджер пакетов для Node.js.

Затем установите необходимые модули:

```bash
npm install node-telegram-bot-api
```

---

#### 2. **Структура проекта**

Организуйте файлы следующим образом:

```
project/
│
├── main.js          # Основной файл бота
├── commands/        # Каталог с обработчиками команд
│   ├── <команда>.js # Файлы с логикой команд
│
```

---

#### 3. **Настройка бота**

1. **Токен Telegram**
    - Вставьте токен вашего Telegram бота в файл `main.js`:

      ```javascript
      const telegramBot = new TelegramBot('<ваш_токен>', {polling: true});
      ```

    - Токен можно получить у @BotFather.

2. **API-сервер**
    - Убедитесь, что API-сервер доступен по адресу:

      ```
      http://localhost:8080/api/v1/
      ```

    - Это значение задается в:

      ```javascript
      module.exports.FINAL_API_URL = "http://localhost:8080/api/v1/";
      ```

---

#### 4. **Добавление команд**

1. Каждая команда должна быть реализована как отдельный файл в каталоге `commands`. Пример структуры команды:

   ```javascript
   module.exports = {
       name: () => "example",
       usage: () => "/example",
       desc: () => "Пример команды",
       handle: (bot, args, chatId) => {
           bot.sendMessage(chatId, "Это пример команды!");
       }
   };
   ```

2. Основной файл `main.js` автоматически подключит все команды из папки `commands`.

---

#### 5. **Запуск бота**

Чтобы запустить бота:

1. Откройте терминал в папке с проектом.
2. Выполните команду:

   ```bash
   node main.js
   ```

3. После запуска бот начнет обрабатывать входящие сообщения.

---

#### 6. **Использование бота**

- Отправьте команду `/help` или `/start`, чтобы получить список доступных команд.
- Пример команды:

  ```
  /example
  ```

- Бот выполнит соответствующую логику и вернет ответ.

---

Убедитесь, что все файлы команд корректно подключены, а API-сервер работает.

Теперь бот готов к использованию! 🎉

---

### Заключение

Данный API предоставляет удобный и безопасный способ для взаимодействия с базой данных уязвимостей, регистрации пользователей, а также возможности для автоматизированного сканирования IP-адресов и доменов на уязвимости.